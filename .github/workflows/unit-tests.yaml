name: 'Unit Tests'
on:
    pull_request:

jobs:
    unit-tests:
        runs-on: 'ubuntu-latest'
        strategy:
            matrix:
                php:
                    - '7.2'
                    - '7.3'
                    - '7.4'
                    - '8.0'
                    - '8.1'
                dependencies:
                    - 'lowest'
                    - 'highest'
                    - 'beta'
                include:
                    - dependencies: 'beta'
        env:
            SYMFONY_VERSION: '${{ matrix.symfony_version }}'
        steps:
            -   name: 'Checkout'
                uses: 'actions/checkout@v2'

            -   name: 'Setup PHP'
                uses: 'shivammathur/setup-php@v2'
                with:
                    php-version: '${{ matrix.php }}'
                    coverage: 'none'
                    tools: 'composer:2'
                    extensions: 'mongodb'
                env:
                    update: true

            - run: 'make composer-compat'

            - run: |
                if [ "${{ matrix.dependencies }}" = "beta" ]; then make composer-config-beta; fi;

            - run: 'composer req symfony/form doctrine/annotations'

            - uses: 'ramsey/composer-install@v2'
              with:
                  dependency-versions: '${{ matrix.dependencies }}'
                  composer-options: '${{ matrix.composer-options }}'

            - run: 'make phpunit-coverage'
